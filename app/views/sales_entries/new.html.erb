<%= render :partial => "layouts/masthead" ,:locals => {
	:title => "Sales Order",
	:description => "Create sales order: for registered customer or unregistered"
}%>


<%= create_breadcrumb(@breadcrumbs).html_safe %>


<div id="content">

	<div class="container">
		
		 
		
		<div class="row">
			 
			<div class="span8">  
				<%= render :partial => "sales_entries/sales_order_summary" , :locals => {
					:sales_order => @sales_order
				}%>
				
				<%= render :partial => "sales_entries/purchased_items" , :locals => {
					:sales_order => @sales_order
				}%>
				
				
			</div> <!-- /.span8 -->
			
			
			<div class="span4">
				<%= render :partial => "sales_entries/sales_entry_trigger_form", :locals => {
					:sales_order => @sales_order 
				} %>
				
				
				<div id='add_product_form_wrapper'> 
				</div> 
			</div> <!-- /.span4 -->
			
		</div> <!-- /.row -->
		
		
		<div class='row'>
		</div><!--  /.row, for displaying the latest StockMigration performed -->
		
	
	</div> <!-- /.container -->
</div> <!-- /#content --> 


<% content_for :additional_js do %> 
  <%= javascript_include_tag "jquery.tokeninput" 	%> 

	<script type="text/javascript"> 
	
  $(document).ready(function() {
			var $search_box = $("#sales_entry_search_item_id");
			var $form = $search_box.parents("form");
			
      $search_box.tokenInput( '<%= search_item_url  %>' , {
					propertyToSearch: "name",
					tokenLimit: 1, 
          onAdd: function (item) {
							$form.spin("large", "black"); 
							$("#selected_item_id").attr( 'value',  item['id'] );
							
 							$.ajax({
							      url: $form.attr("action"),
							      type: "POST",
							      data: $form.serialize(),
							      dataType: 'script',
							      success: function(response){ 
								
							      }
							    }); 
          } ,
					onDelete: function(item){
						$("#add_product_form").remove();
					}
      });
  });

  </script>
<% end %>

<% content_for :additional_css do %> 
  <%= stylesheet_link_tag "token-input", "token-input-facebook" 	%> 
<% end %>