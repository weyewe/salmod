$(document).ready(function() {
		var $search_box = $("#sales_entry_search_item_id");
		var $form = $search_box.parents("form"); 
		var search_item_url = $("#search_item_url").val(); 
    $search_box.tokenInput( search_item_url , {
				propertyToSearch: "name",
				tokenLimit: 1, 
        onAdd: function (item) {
						$form.spin("large", "black"); 
						$("#selected_item_id").attr( 'value',  item['id'] );
						
						$.ajax({
						      url: $form.attr("action"),
						      type: "POST",
						      data: $form.serialize(),
						      dataType: 'script',
						      success: function(response){ 
							
						      }
						    }); 
        } ,
				onDelete: function(item){
					$("#add_product_form").remove();
				}
    });

// 
// FOR THE SERVICE
// 
		var $search_service_box = $("#sales_entry_search_service_id");
		var $service_form = $search_service_box.parents("form");
		
		var search_service_url = $("#search_service_url").val(); 
		    $search_service_box.tokenInput( search_service_url , {
				propertyToSearch: "name",
				tokenLimit: 1, 
		        onAdd: function (item) {
						$service_form.spin("large", "black"); 
						$("#selected_service_id").attr( 'value',  item['id'] );
						
						$.ajax({
						      url: $service_form.attr("action"),
						      type: "POST",
						      data: $service_form.serialize(),
						      dataType: 'script',
						      success: function(response){ 
							
						      }
						    }); 
		        } ,
				onDelete: function(item){
					$("#add_service_form").remove();
				}
		});



		$(".delete_entry").live("click", function(){
			var yes_value = "Yes"; 
			var cancel_value = 'false';
			var $this = $(this); 
			var $row = $this.parents("tr")
			var entry_id = $row.attr("id").split('-')[1];  
			var $form = $("#delete_entry_form_wrapper form"); 
			var $identifier = $(".identifier", $row);

			$.msgbox("Yakin untuk menghapus:" + $identifier.text() +  " ?", {
			  type: "confirm",
			  buttons : [
			    {type: "submit", value: yes_value}, 
			    {type: "cancel", value: "Cancel"}
			  ]
			}, function(result) { 
				if( result == yes_value){ 

					$("#object_to_destroy_id").attr("value", entry_id ); 
					$row.spin("large", "black"); 

			    $.ajax({
			      url: $form.attr("action"),
			      type: "POST",
			      data: $form.serialize(),
			      dataType: 'script',
			      success: function(response){
			        $form.clearForm();
			      }
			    }); 
				}
			});

			return false;  
		});
		
		// updating sales entry 
		// what will happen?
		//  1. show the modal, load for the edit form
		// 	2. user edit the form, some magic happens in the server
		// 	3. if it is successful, modal is closed. msgbox is allerted, update the row 
		// 	4. if it is not successful, modal is not closed, showing the new form with error
		
		$('#editEntry').modal({
			keyboard: false,
			backdrop: 'static' ,
			show: false 
		});
		
		
		$(".edit_entry").live("click", function(){
			
			
			var $modal = $("#editEntry");
			$modal.modal('show'); 
			
			$(".modal_closer", $modal ).click(function(){
				$modal.modal('hide'); 
				$("form", $modal).remove(); 
			});
			
			
			var get_form_url =  $(this).attr("href");
			
			// get the edit form 
			$.ajax({
				url: get_form_url,
				type: "GET",
				// data: $form.serialize(),
				dataType: 'script',
				success: function(response){ 
					// it is live.. ajax-form class
				}
			}); 
			
			return false; 
		});
		
		
		
		
});